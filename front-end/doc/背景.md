<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
# Ipcweb前端重构（一）背景  
随着网络的普及，以及终端硬件性能和带宽的提升，物联网的智能设备得以普及。_IPCAMERA_就是我司物联网智能设备的先驱者，早在13年就开始进行设计和研发，14年正式上线。

#### Ipcweb  
Ipcweb是指为产品_IPCAMERA_开发维护的提供云服务的ipc云中的门户网站，是一个web服务器，正式版访问地址[在此][ipcweb正式版地址]。它的业务范围如下:

* 可以让用户在登陆后对接入互联网的设备进行远程监控和操作。
* 提供给用户设置用户信息的入口。
* 提供给用户获取最新信息和反馈意见的链接。

本系列文档将结合背景，现状和方案，先进理念，设计原则等方面对ipcweb的前端的代码进行详细的介绍。

在介绍Ipcweb时有必要介绍一下ipc云的更新历史。因为每次ipc云进行更新，都将导致ipcweb的需求变化，需求变化会导致设计思路的变化。

#### Ipc云的更新历史  
Ipcweb运行至今，已经正式发布了四个版本。针对ipc云的更迭，ipcweb也有许多需求变化:

1. 1.0.版本，此版本为第一个正式上线的版本。属于从0到1的开拓性里程碑，它界定了ipc云的能力范围，明确了ipc云的核心需求，奠定了ipc云优化迭代的基石。但由于迫切的成品输出的需求，架构设计的相对简单粗暴，业务代码统一维护，从而导致业务区分不清晰，耦合度程度高，不易拓展，也不能针对不同业务进行优化。ipcweb则界定了几乎所有业务范围内的需求。包括用户管理，设备管理，信息咨询等。
2. 2.0.版本，此版本在1.0.的基础上对架构进行优化，将业务区分变得更加合理，同时加入了自动化部署系统以及监控系统，有效的提高了业务的可用性。在我看来，这个版本的ipc云真正做到了人力资源最大化，不同业务模块协同合作，各自开发互不影响。事实上，本司的云平台基础云就是以此架构为基础进行开发与迭代的。ipcweb前端变化不大，主要变化在于后台，将之前的大杂烩服务器拆分出业务不同的服务器，而后续的web则主要作为web服务器，不再提供认证，数据持久化等业务。
3. 3.0.版本。版本更迭的主要起因是公司为整合和统一管理云资源，所以将云分为基础云和业务云。基础云负责物联网设备的基础业务，例如支持设备上线，数据持久化，认证等；业务云主要负责相关的产品的主要业务，例如ipc云主要负责_IPCAMERA_的业务直播和web。此版本中ipc云更改特别大，因为之前依赖的基础业务全部被替换，其中还包括一些数据一致性，跨域等问题均需要ipc云来做相应的兼容。
4. 3.1.版本。升级的主要原因是，在部分环境下，核心业务不可用，即在chrome42(42及以上)和edge浏览器不再支持已有的直播技术(利用NPAPI插件)。所以更新直播技术是此版本的主要需求。在这个版本中，ipcweb主要需求变化在于前端，针对不同的环境采用不同的直播技术。

#### 为什么重构

在经历了几次迭代之后，本就不怎么健壮的ipcweb前端代码维护起来相当困难，拓展更是不易。这就暴露了前端代码的诸多缺点。

1. 纯面向过程编码。通常一个函数方法可以上几百行，这就导致复用性不强，维护起来还相当麻烦。拓展性更不用提。
2. 大量的全局变量。这就导致代码可控性非常低，细微的修改可能导致莫名其妙的问题。
3. 紧耦合的封装导致该封装等于0。一个弹窗类里面包含了主业务代码的全局变量，导致在其他的页面该弹窗类完全无法用。
4. 大量的冗余，废弃的代码。新人接手根本不知道这些代码是不是废弃代码，不敢修改，导致后续的代码只会是一直增加。
5. 前后端代码耦合。Php的代码耦合在前端代码中，针对切换后端解决方案相当不利。
6. 除此之外还有命名不规则，css，html代码混乱等。

所以在此背景下，重构显得非常的必要，不仅是为了清理旧代码，换一种清晰干净的编写方式，还为了能够快速应对需求变化，易拓展易维护。所以重构势在必行。

[ipcweb正式版地址]: https://www.tplinkcloud.com